最近有个项目，需要实现这样一个功能：输入一个值对象，对其进行校验处理，返回一个布尔型的结果以及一个错误信息的字符串。校验的过程与业务逻辑有关，需要有很大的灵活性。

针对这种场景，一种解决方案是，实现一个DSL，业务方按照规定的语法规则编写校验逻辑。这样就可以把业务校验和平台功能模块给解耦合。

于是我就开始看DSL相关的介绍，以及一些基本的知识点。记录一下学习的结果。

# 什么是DSL

## 概念

DSL(Domain-Specific Language)领域专用语言，是一种针对特定问题的编程语言。它的基本思路是提供从问题域映射到解答域的实现模型。

DSL含有建模所需的语法和语义，在与问题域相同的抽象层次对概念建模。

这里有几个概念需要理解：

1. **问题域**构成你所分析业务的那些过程、实体和约束条件。
2. **解答域**提供工具和手段，实现问题域的分析模型。问题域的元素需要映射成解答与中适当的技术手段。
3. **领域建模**(也称领域分析) 用于帮助你分析、理解并识别某项具体活动所有参与方的活动。领域建模的基本实践活动就是把问题域映射到解答域的若干制品，让所有的元素、相互作用和协作关系都得到正确而合理的表示。
4. **共通语汇**在模型的所有关联方之中共享，作为一股维系力量把组成实现的各部分制品统一起来。领域建模的第一步是确定共通语汇。

举个例子，买一点点的时候，你说“我要一杯大杯的波霸奶茶，去冰，全糖，支付宝支付”，你会得到一杯符合你要求的奶茶。但是如果你在星巴克说同样的话，服务员会一脸懵逼。这是因为，“一杯大杯的波霸奶茶，去冰，全糖”这句话是买一点点场景的DSL，不适用于买星巴克。其中，一点点饮料就是问题域，一点点工作人员就是解答域，为了让工作人员听懂你想要什么，就需要一个语汇来做交流，这个就是菜单，它就是领域建模的一个结果。

## 特征

DSL的特征有两点：

1. 一种DSL专门针对一个特定的问题领域。(即有限表达力 limited expressivity)
2. DSL含有建模所需的语法和语义，在与问题域相同的抽象层次对概念建模。

怎么理解第二点呢？我个人对其的理解是，问题域与DSL需要在同一个抽象的层次，比如你需要解决"买一点点"的问题，你的DSL就不能是用来解决"去任何奶茶店点单"的问题。因为"买一点点奶茶"和"买奶茶"不是一个抽奖层次。

DSL区别于高级编程语言的特征：

1. DSL给予用户更高层次的抽象。用户不必分心于具体数据结构的微妙差别等低层次细节，而是专注于解决手头的问题。
2. DSL只提供优先的词汇，不超出他的领域范围，表现力有限。

因此，一些场景下，DSL可以给非程序员使用。

## 流行的DSL

DSL | 用途
--- | ---
SQL | 关系型数据库语言，用于查询和变更数据
Ant、Rake、Make | 用于软件系统构建的语言
CSS | 样式表描述语言
YACC、Bison、ANTLR | 用来生成语法分析器的语言
RSpec、Cucumber | Ruby环境下的行为驱动测试语言
HTML | 用于Web的标记语言

 


